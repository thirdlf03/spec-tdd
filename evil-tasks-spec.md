Taskç®¡ç†API ä»•æ§˜æ›¸ï¼ˆPRDé¢¨ï¼‰

èƒŒæ™¯
ç§ãŸã¡ã®å°è¦æ¨¡ãƒãƒ¼ãƒ ã§ã¯ã€ã‚¿ã‚¹ã‚¯ã®ä½œæˆãƒ»æ›´æ–°ãƒ»æ¤œç´¢ã‚’è»½é‡ã«è¡Œãˆã‚‹ä»•çµ„ã¿ãŒå¿…è¦ã«ãªã£ã¦ã„ã‚‹ã€‚
ç¾è¡Œãƒ„ãƒ¼ãƒ«ã¯å…¥åŠ›ã®æºã‚Œã‚„é‹ç”¨ãƒ«ãƒ¼ãƒ«ãŒçµ±ä¸€ã•ã‚Œã¦ãŠã‚‰ãšã€ã‚¿ã‚¤ãƒˆãƒ«ã‚„ã‚¿ã‚°ã®è¡¨è¨˜æºã‚Œã«ã‚ˆã‚‹æ¤œç´¢æ¼ã‚ŒãŒå¤šã„ã€‚
ãã“ã§ã€å…¥åŠ›ã®æ­£è¦åŒ–ã‚„æ›´æ–°ç«¶åˆã®åˆ¶å¾¡ã‚’æ¨™æº–åŒ–ã—ãŸTaskç®¡ç†APIã‚’å®šç¾©ã™ã‚‹ã€‚

ç›®çš„
- ã‚¿ã‚¹ã‚¯ã‚’ä¸€è²«ã—ãŸå½¢å¼ã§ä¿å­˜ãƒ»å–å¾—ã§ãã‚‹ã“ã¨
- æ›´æ–°ã®ç«¶åˆã‚’é˜²æ­¢ã—ã€ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ã‚’ä¿ã¤ã“ã¨
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒã€Œä»•æ§˜é€šã‚Šã€ã«å®Ÿè£…ã§ãã‚‹ã‹ã‚’çŸ­æ™‚é–“ã§æ¤œè¨¼ã§ãã‚‹ã“ã¨

ã‚¹ã‚³ãƒ¼ãƒ—
- REST APIã¨ã—ã¦æä¾›ã™ã‚‹
- æ°¸ç¶šåŒ–ã¯ä¸è¦ï¼ˆãƒ¡ãƒ¢ãƒªä¸Šã®ä¿å­˜ã§å¯ï¼‰
- ã™ã¹ã¦ã®å…¥å‡ºåŠ›ã¯ JSON
- ãƒ™ãƒ¼ã‚¹URLã¯ /v1
- ã‚µãƒ¼ãƒã¯ localhost:8000 ã§å¾…å—ã‘ã‚‹ã“ã¨

éç›®æ¨™ï¼ˆOut of Scopeï¼‰
- èªè¨¼/èªå¯
- ãƒãƒ«ãƒãƒ¦ãƒ¼ã‚¶å¯¾å¿œ
- ãƒ•ã‚¡ã‚¤ãƒ«æ·»ä»˜
- æ°¸ç¶šã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸é€£æº

éæ©Ÿèƒ½è¦ä»¶
- ã‚¨ãƒ©ãƒ¼ã¯å¿…ãšè¦å®šã®JSONå½¢å¼ã§è¿”ã™
- 400/409/412/415/422ãªã©ã€é©åˆ‡ãªHTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¿”ã™
- æ™‚åˆ»ã¯UTCã§æ‰±ã„ã€ISO 8601æ–‡å­—åˆ—ã§è¿”ã™
- å‚ç…§ç³»APIã¯å‰¯ä½œç”¨ã‚’æŒãŸãªã„

é–‹ç™ºãƒ»æ¤œè¨¼
- ãƒ†ã‚¹ãƒˆã¯ localhost:8000 ã«å¯¾ã—ã¦HTTPã§å®Ÿè¡Œã•ã‚Œã‚‹
- å®Ÿè£…è€…ã¯ã‚µãƒ¼ãƒã‚’èµ·å‹•ã—ãŸçŠ¶æ…‹ã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹

ç”¨èª
- ã‚¿ã‚¹ã‚¯: æœ¬APIã§ç®¡ç†ã™ã‚‹ä½œæ¥­é …ç›®
- è«–ç†å‰Šé™¤: ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã—ãŸã¾ã¾å‰Šé™¤æ‰±ã„ã«ã™ã‚‹ã“ã¨
- UTCæ—¥ä»˜: UTCã«ãŠã‘ã‚‹æ—¥ä»˜ï¼ˆYYYY-MM-DDï¼‰

ãƒ‡ãƒ¼ã‚¿å®šç¾©
Taskã¯ä»¥ä¸‹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å¿…é ˆã¨ã™ã‚‹ï¼ˆé †åºä¸å•ï¼‰ã€‚
- id: stringï¼ˆæ­£è¦è¡¨ç¾ ^[A-Z0-9]{8}$ï¼‰
- title: string
- description: string | null
- status: "open" | "done"
- priority: integerï¼ˆ1..5ï¼‰
- dueDate: string | nullï¼ˆYYYY-MM-DDï¼‰
- tags: string[]ï¼ˆå¸¸ã«é…åˆ—ã€‚ç©ºé…åˆ—å¯ï¼‰
- blockedBy: string[]ï¼ˆä¾å­˜å…ˆã‚¿ã‚¹ã‚¯IDã®é…åˆ—ã€‚ç©ºé…åˆ—å¯ï¼‰â€»è¿½åŠ æ©Ÿèƒ½ã€Œã‚¿ã‚¹ã‚¯ä¾å­˜é–¢ä¿‚ã€å‚ç…§
- parentId: string | nullï¼ˆè¦ªã‚¿ã‚¹ã‚¯ã®IDï¼‰â€»è¿½åŠ æ©Ÿèƒ½ã€Œã‚µãƒ–ã‚¿ã‚¹ã‚¯ã€å‚ç…§
- progress: integerï¼ˆ0..100ã€è‡ªå‹•è¨ˆç®—ï¼‰â€»è¿½åŠ æ©Ÿèƒ½ã€Œã‚µãƒ–ã‚¿ã‚¹ã‚¯ã€å‚ç…§
- createdAt: stringï¼ˆISO 8601, UTCï¼‰
- updatedAt: stringï¼ˆISO 8601, UTCï¼‰
- deletedAt: string | nullï¼ˆISO 8601, UTCï¼‰
- version: integerï¼ˆ1ã‹ã‚‰é–‹å§‹ã—æ›´æ–°ã”ã¨ã«+1ï¼‰

å…±é€šä»•æ§˜
1) ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹
- Content-Type ãŒ application/json ä»¥å¤–ã®å ´åˆã¯ 415
- ä¸æ­£ãªJSONã¯ 400
- unknown field ã¯ 400
- ãƒœãƒ‡ã‚£ã¯JSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰æã¨ã—ã€é…åˆ—ãªã©ã®å ´åˆã¯ 400

2) æ­£è¦åŒ–ãƒ«ãƒ¼ãƒ«
- title: å‰å¾Œç©ºç™½é™¤å»ã€é€£ç¶šã™ã‚‹ç©ºç™½(ç©ºç™½/ã‚¿ãƒ–/æ”¹è¡Œ)ã¯1ã¤ã®åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã«æ­£è¦åŒ–
- description: å‰å¾Œç©ºç™½é™¤å»ã€‚ç©ºæ–‡å­—ã«ãªã‚‹å ´åˆã¯ null ã¨ã¿ãªã™
- tags: å„è¦ç´ ã‚’å‰å¾Œç©ºç™½é™¤å»â†’å°æ–‡å­—åŒ–ã€‚ç©ºè¦ç´ ã¯é™¤å»ã€‚é‡è¤‡ã‚’é™¤å»ã—æ˜‡é †ã‚½ãƒ¼ãƒˆ
- dueDate: "YYYY-MM-DD" å½¢å¼ã§å®Ÿåœ¨ã™ã‚‹æ—¥ä»˜ã®ã¿è¨±å¯
- status ãŒ "open" ã®å ´åˆã€dueDate ã¯ã€Œä»Šæ—¥(UTCæ—¥ä»˜)ä»¥é™ã€ã®ã¿è¨±å¯ã€‚éå»æ—¥ã¯ 422
- status ãŒ "done" ã®å ´åˆã€dueDate ã®éå»æ—¥ã¯è¨±å¯
- title ã®ä¸€æ„æ€§ã¯ã€Œæ­£è¦åŒ–å¾Œã®å¤§æ–‡å­—å°æ–‡å­—ã‚’ç„¡è¦–ã—ãŸå€¤ã€ã§æ¯”è¼ƒï¼ˆdeletedAtãŒnullã®ã‚‚ã®ã®ã¿å¯¾è±¡ï¼‰

3) ETag / If-Match
- æœ¬ç¯€ã¯ Task / Label ã«é©ç”¨ã™ã‚‹ï¼ˆProjectã¯å€‹åˆ¥ä»•æ§˜ã«å¾“ã†ï¼‰
- GET(å˜ä¸€), POST, PATCH, DELETE ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã« ETag ã‚’ä»˜ä¸ã™ã‚‹
- ETag å€¤ã¯ `"${version}"`ï¼ˆãƒ€ãƒ–ãƒ«ã‚¯ã‚ªãƒ¼ãƒˆè¾¼ã¿ï¼‰
- PATCH/DELETE ã¯ If-Match å¿…é ˆã€‚æœªæŒ‡å®šã¯ 428
- If-Match ãŒç¾è¡Œã® ETag ã¨ä¸€è‡´ã—ãªã„å ´åˆã¯ 412

ã‚¨ãƒ©ãƒ¼ä»•æ§˜
{
  "error": {
    "code": "validation_error | conflict | not_found | unknown_field | invalid_json | unsupported_media_type | precondition_required | precondition_failed",
    "message": "äººé–“å‘ã‘ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸",
    "fields": { "fieldName": "reason" } // ä»»æ„
  }
}

æ©Ÿèƒ½è¦ä»¶ï¼ˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
1) POST /v1/tasks
ç›®çš„: ã‚¿ã‚¹ã‚¯ä½œæˆ
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ(JSON):
{
  "id"?: string,
  "title": string,
  "description"?: string | null,
  "status"?: "open" | "done",
  "priority"?: integer,
  "dueDate"?: string | null,
  "tags"?: string[] | null
}

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³:
- title: å¿…é ˆã€‚æ­£è¦åŒ–å¾Œã®é•·ã• 1..80ã€‚é•åã¯ 422
- id: ä»»æ„ã€‚æŒ‡å®šæ™‚ã¯ ^[A-Z0-9]{8}$ã€‚æ—¢å­˜ID(å‰Šé™¤æ¸ˆã¿å«ã‚€)ã¨é‡è¤‡ã§ 409
- description: æœ€å¤§ 2000ã€‚null/ç©ºã¯è¨±å¯
- status: æœªæŒ‡å®šæ™‚ "open"
- priority: æœªæŒ‡å®šæ™‚ 3ã€‚1..5 ã®æ•´æ•°ä»¥å¤–ã¯ 422
- dueDate: å…±é€šä»•æ§˜ã«å¾“ã†
- tags: æœªæŒ‡å®šæ™‚ã¯ç©ºé…åˆ—ã€‚null ã¯ç©ºé…åˆ—æ‰±ã„ã€‚æ­£è¦åŒ–å¾Œ 0..5 è¦ç´ ã¾ã§ã€‚å„è¦ç´ ã¯ ^[a-z0-9-]{1,15}$
- title ã®ä¸€æ„æ€§ãŒè¡çªã—ãŸå ´åˆã¯ 409
- unknown field ã¯ 400

ãƒ¬ã‚¹ãƒãƒ³ã‚¹(201):
- Location: /v1/tasks/{id}
- Body: Task

2) GET /v1/tasks
ç›®çš„: ä¸€è¦§å–å¾—
ã‚¯ã‚¨ãƒª:
- q: æ–‡å­—åˆ—ã€‚title ã¾ãŸã¯ description ã«éƒ¨åˆ†ä¸€è‡´ï¼ˆå¤§æ–‡å­—å°æ–‡å­—ç„¡è¦–ï¼‰ã€‚ç©ºæ–‡å­—ã¯æœªæŒ‡å®šæ‰±ã„
- tags: ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼ˆä¾‹: tags=a,b,cï¼‰ã€‚ANDæ¡ä»¶ã€‚å„è¦ç´ ã¯å‰å¾Œç©ºç™½é™¤å»ãƒ»å°æ–‡å­—åŒ–ã—ã¦æ¯”è¼ƒ
- status: "open" | "done"
- includeDeleted: "true" | "false" | "only"ï¼ˆdefault: falseï¼‰
- sort: "createdAt" | "updatedAt" | "priority" | "dueDate" | "title"ï¼ˆdefault: updatedAtï¼‰
  - dueDate ã§ã‚½ãƒ¼ãƒˆæ™‚ã€null å€¤ã¯ asc ã®å ´åˆã¯æœ€å¾Œã€desc ã®å ´åˆã¯æœ€åˆã«é…ç½®ã•ã‚Œã‚‹
- order: "asc" | "desc"ï¼ˆdefault: descï¼‰
- limit: 1..50ï¼ˆdefault: 20ï¼‰
- offset: 0ä»¥ä¸Šã®æ•´æ•°ï¼ˆdefault: 0ï¼‰

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³:
- limit/offset/sort/order/status/includeDeleted ãŒä¸æ­£ãªå ´åˆã¯ 422

ãƒ¬ã‚¹ãƒãƒ³ã‚¹(200):
{
  "items": Task[],
  "total": number, // ãƒ•ã‚£ãƒ«ã‚¿å¾Œãƒ»ãƒšãƒ¼ã‚¸ãƒ³ã‚°å‰ã®ä»¶æ•°
  "limit": number,
  "offset": number
}

3) GET /v1/tasks/:id
- å­˜åœ¨ã—ãªã„IDã¯ 404
- deletedAt ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€includeDeleted=true ã®æ™‚ã®ã¿è¿”ã™ã€‚ãã‚Œä»¥å¤–ã¯ 404
- includeDeleted ã¯ "true" ã®ã¿ã‚’æœ‰åŠ¹å€¤ã¨ã—ã€ãã®ä»–ã®å€¤ã¯ false ã¨åŒç­‰ã«æ‰±ã†
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã« ETag ã‚’ä»˜ä¸

4) PATCH /v1/tasks/:id
ç›®çš„: éƒ¨åˆ†æ›´æ–°
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ(JSON):
- ç©ºã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ 400ï¼ˆvalidation_errorï¼‰
- JSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä»¥å¤–ã¯ 400ï¼ˆvalidation_errorï¼‰
- æ›´æ–°å¯èƒ½: title, description, status, priority, dueDate, tags
- id/createdAt/updatedAt/deletedAt/version ã‚’å«ã‚ãŸå ´åˆã¯ 400
- description/dueDate/tags ã¯ null ã§ã‚¯ãƒªã‚¢å¯èƒ½
- title é‡è¤‡ã¯ 409
- deletedAt ãŒå­˜åœ¨ã™ã‚‹ã‚¿ã‚¹ã‚¯ã¯æ›´æ–°ä¸å¯ï¼ˆ409ï¼‰
- æ­£å¸¸æ™‚ã€updatedAt ã¨ version ã‚’æ›´æ–°ã™ã‚‹ï¼ˆå®Ÿè³ªå¤‰åŒ–ãŒãªãã¦ã‚‚æ›´æ–°ï¼‰

ãƒ¬ã‚¹ãƒãƒ³ã‚¹(200): Task

5) DELETE /v1/tasks/:id
ç›®çš„: è«–ç†å‰Šé™¤
- deletedAt ã‚’ç¾åœ¨æ™‚åˆ»(UTC)ã«è¨­å®šã—ã€version+1
- æ—¢ã«å‰Šé™¤æ¸ˆã¿ã®å ´åˆã¯ 404
- å­˜åœ¨ã—ãªã„IDã¯ 404
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ Task

è¿½åŠ æ©Ÿèƒ½: ãƒ©ãƒ™ãƒ«ç®¡ç†ï¼ˆLabelï¼‰
èƒŒæ™¯
ã‚¿ã‚¹ã‚¯ã®åˆ†é¡ã‚’ç¾å ´ã®è¨€è‘‰ã«åˆã‚ã›ã¦æ•´ç†ã§ãã‚‹ã‚ˆã†ã€ãƒ©ãƒ™ãƒ«æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ã€‚
ã‚¿ã‚°ã‚ˆã‚Šã‚‚å³å¯†ãªé‹ç”¨ã‚’å‰æã¨ã—ã€åç§°ã®æºã‚Œã‚„è‰²ã®è¡¨è¨˜ã‚†ã‚Œã‚’æŠ‘ãˆã‚‹ã€‚

Labelãƒ‡ãƒ¼ã‚¿å®šç¾©
- id: stringï¼ˆæ­£è¦è¡¨ç¾ ^[a-z][a-z0-9-]{2,15}$ï¼‰
- name: string
- description: string | null
- color: stringï¼ˆæ­£è¦è¡¨ç¾ ^#[0-9A-F]{6}$ï¼‰
- visibility: "public" | "private"
- createdAt: stringï¼ˆISO 8601, UTCï¼‰
- updatedAt: stringï¼ˆISO 8601, UTCï¼‰
- deletedAt: string | nullï¼ˆISO 8601, UTCï¼‰
- version: integerï¼ˆ1ã‹ã‚‰é–‹å§‹ã—æ›´æ–°ã”ã¨ã«+1ï¼‰

Labelã®å…±é€šãƒ«ãƒ¼ãƒ«
- name: å‰å¾Œç©ºç™½é™¤å»ã€é€£ç¶šç©ºç™½ã¯1ã¤ã®åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã€‚æ­£è¦åŒ–å¾Œ 1..30
- description: å‰å¾Œç©ºç™½é™¤å»ã€‚ç©ºæ–‡å­—ã¯ nullã€‚æœ€å¤§ 200
- visibility: æœªæŒ‡å®šæ™‚ã¯ "public"
- visibility ãŒ "private" ã®å ´åˆã€description ã¯ null ä»¥å¤–ã§ã‚ã‚‹ã“ã¨
- name ã®ä¸€æ„æ€§ã¯ã€Œæ­£è¦åŒ–å¾Œã®å¤§æ–‡å­—å°æ–‡å­—ã‚’ç„¡è¦–ã—ãŸå€¤ã€ã§æ¯”è¼ƒï¼ˆdeletedAtãŒnullã®ã‚‚ã®ã®ã¿å¯¾è±¡ï¼‰
- id ã¯ä»»æ„ã€‚æŒ‡å®šæ™‚ã¯æ­£è¦è¡¨ç¾ã«ä¸€è‡´ã™ã‚‹ã“ã¨ã€‚æ—¢å­˜ID(å‰Šé™¤æ¸ˆã¿å«ã‚€)ã¨é‡è¤‡ã§ 409

1) POST /v1/labels
ç›®çš„: ãƒ©ãƒ™ãƒ«ä½œæˆ
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ(JSON):
{
  "id"?: string,
  "name": string,
  "description"?: string | null,
  "color": string,
  "visibility"?: "public" | "private"
}

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³:
- name: å¿…é ˆã€‚æ­£è¦åŒ–å¾Œã®é•·ã• 1..30
- color: ^#[0-9A-F]{6}$
- description: æœ€å¤§ 200
- visibility: "public" | "private"
- unknown field ã¯ 400

ãƒ¬ã‚¹ãƒãƒ³ã‚¹(201):
- Location: /v1/labels/{id}
- Body: Label

2) GET /v1/labels
ç›®çš„: ä¸€è¦§å–å¾—
ã‚¯ã‚¨ãƒª:
- q: æ–‡å­—åˆ—ã€‚name ã¾ãŸã¯ description ã«éƒ¨åˆ†ä¸€è‡´ï¼ˆå¤§æ–‡å­—å°æ–‡å­—ç„¡è¦–ï¼‰
- visibility: "public" | "private"
- includeDeleted: "true" | "false" | "only"ï¼ˆdefault: falseï¼‰
- sort: "name" | "createdAt" | "updatedAt"ï¼ˆdefault: createdAtï¼‰
- order: "asc" | "desc"ï¼ˆdefault: ascï¼‰
- limit: 1..50ï¼ˆdefault: 20ï¼‰
- offset: 0ä»¥ä¸Šã®æ•´æ•°ï¼ˆdefault: 0ï¼‰

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³:
- limit/offset/sort/order/visibility/includeDeleted ãŒä¸æ­£ãªå ´åˆã¯ 422

ãƒ¬ã‚¹ãƒãƒ³ã‚¹(200):
{
  "items": Label[],
  "total": number,
  "limit": number,
  "offset": number
}

3) GET /v1/labels/:id
- å­˜åœ¨ã—ãªã„IDã¯ 404
- deletedAt ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€includeDeleted=true ã®æ™‚ã®ã¿è¿”ã™ã€‚ãã‚Œä»¥å¤–ã¯ 404
- includeDeleted ã¯ "true" ã®ã¿ã‚’æœ‰åŠ¹å€¤ã¨ã—ã€ãã®ä»–ã®å€¤ã¯ false ã¨åŒç­‰ã«æ‰±ã†
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã« ETag ã‚’ä»˜ä¸

4) PATCH /v1/labels/:id
ç›®çš„: éƒ¨åˆ†æ›´æ–°
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ(JSON):
- ç©ºã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ 400ï¼ˆvalidation_errorï¼‰
- JSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä»¥å¤–ã¯ 400ï¼ˆvalidation_errorï¼‰
- æ›´æ–°å¯èƒ½: name, description, color, visibility
- description ã¯ null ã§ã‚¯ãƒªã‚¢å¯èƒ½
- id/createdAt/updatedAt/deletedAt/version ã‚’å«ã‚ãŸå ´åˆã¯ 400
- deletedAt ãŒå­˜åœ¨ã™ã‚‹ãƒ©ãƒ™ãƒ«ã¯æ›´æ–°ä¸å¯ï¼ˆ409ï¼‰
- æ­£å¸¸æ™‚ã€updatedAt ã¨ version ã‚’æ›´æ–°ã™ã‚‹

ãƒ¬ã‚¹ãƒãƒ³ã‚¹(200): Label

5) DELETE /v1/labels/:id
ç›®çš„: è«–ç†å‰Šé™¤
- deletedAt ã‚’ç¾åœ¨æ™‚åˆ»(UTC)ã«è¨­å®šã—ã€version+1
- æ—¢ã«å‰Šé™¤æ¸ˆã¿ã®å ´åˆã¯ 404
- å­˜åœ¨ã—ãªã„IDã¯ 404
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ Label

è¿½åŠ æ©Ÿèƒ½: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ï¼ˆProjectï¼‰
èƒŒæ™¯
ã‚¿ã‚¹ã‚¯ã‚’æ©Ÿèƒ½æ¨ªæ–­ã§ã¾ã¨ã‚ã‚‹ãŸã‚ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå˜ä½ã®ç®¡ç†ã‚’è¿½åŠ ã™ã‚‹ã€‚
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯é–‹å§‹/çµ‚äº†æ—¥ã®ç®¡ç†ã‚„äºˆç®—ã®ç®¡ç†ã‚’è¡Œã„ã€ãƒãƒ¼ãƒ å¤–ã¸ã®å…±æœ‰å˜ä½ã¨ã—ã¦ã‚‚ä½¿ã†ã€‚

Projectãƒ‡ãƒ¼ã‚¿å®šç¾©
- id: stringï¼ˆæ­£è¦è¡¨ç¾ ^PRJ-[A-Z0-9]{6}$ï¼‰
- name: string
- key: stringï¼ˆæ­£è¦è¡¨ç¾ ^[a-z][a-z0-9-]{2,12}$ï¼‰
- ownerEmail: string
- status: "active" | "archived"
- budget: integer | nullï¼ˆ0..1000000ï¼‰
- startDate: string | nullï¼ˆYYYY-MM-DDï¼‰
- endDate: string | nullï¼ˆYYYY-MM-DDï¼‰
- createdAt: stringï¼ˆISO 8601, UTCï¼‰
- updatedAt: stringï¼ˆISO 8601, UTCï¼‰
- archivedAt: string | nullï¼ˆISO 8601, UTCï¼‰
- version: integerï¼ˆ1ã‹ã‚‰é–‹å§‹ã—æ›´æ–°ã”ã¨ã«+1ï¼‰

Projectã®å…±é€šãƒ«ãƒ¼ãƒ«
- name: å‰å¾Œç©ºç™½é™¤å»ã€é€£ç¶šç©ºç™½ã¯1ã¤ã®åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã€‚æ­£è¦åŒ–å¾Œ 3..60
- key: å°æ–‡å­—ã‚¹ãƒ©ãƒƒã‚°ã€‚é‡è¤‡ã¯409ï¼ˆå‰Šé™¤æ¸ˆã¿ãŒãªã„ãŸã‚ã€æ—¢å­˜ã®ã¿ã§åˆ¤å®šï¼‰
- name ã®ä¸€æ„æ€§ã¯ã€Œæ­£è¦åŒ–å¾Œã®å¤§æ–‡å­—å°æ–‡å­—ã‚’ç„¡è¦–ã—ãŸå€¤ã€ã§æ¯”è¼ƒ
- ownerEmail: å½¢å¼ã¯ç°¡æ˜“çš„ã«ã€Œ@ã€ã¨ã€Œ.ã€ã‚’å«ã‚€ã“ã¨
- budget: æœªæŒ‡å®šæ™‚ã¯ nullã€‚0..1000000ã®æ•´æ•°
- startDate/endDate: å®Ÿåœ¨ã™ã‚‹æ—¥ä»˜ã®ã¿è¨±å¯
- startDate ã¨ endDate ãŒä¸¡æ–¹ã‚ã‚‹å ´åˆã€endDate >= startDate ã‚’æº€ãŸã™ã“ã¨
- status: æœªæŒ‡å®šæ™‚ã¯ "active"
- status ãŒ "archived" ã®å ´åˆã€archivedAt ã‚’ç¾åœ¨æ™‚åˆ»(UTC)ã§è¨­å®š

Projectã®ETag/If-Match
- GET(å˜ä¸€), POST, PATCH, archive/restore ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã« ETag ã‚’ä»˜ä¸ã™ã‚‹
- ETag å€¤ã¯ `"${version}"`ï¼ˆãƒ€ãƒ–ãƒ«ã‚¯ã‚ªãƒ¼ãƒˆè¾¼ã¿ï¼‰
- PATCH ã¯ If-Match å¿…é ˆã€‚æœªæŒ‡å®šã¯ 428ã€‚ETagä¸ä¸€è‡´ã¯ 412

1) POST /v1/projects
ç›®çš„: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ(JSON):
{
  "id"?: string,
  "name": string,
  "key": string,
  "ownerEmail": string,
  "status"?: "active" | "archived",
  "budget"?: integer | null,
  "startDate"?: string | null,
  "endDate"?: string | null
}

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³:
- name: å¿…é ˆã€‚æ­£è¦åŒ–å¾Œã®é•·ã• 3..60
- key: å¿…é ˆã€‚æ­£è¦è¡¨ç¾ ^[a-z][a-z0-9-]{2,12}$
- ownerEmail: å¿…é ˆã€‚ç°¡æ˜“å½¢å¼ãƒã‚§ãƒƒã‚¯
- id: ä»»æ„ã€‚æŒ‡å®šæ™‚ã¯ ^PRJ-[A-Z0-9]{6}$
- status: "active" | "archived"
- budget: 0..1000000 ã®æ•´æ•°ã€nullå¯
- startDate/endDate: æ—¥ä»˜å½¢å¼ã«å¾“ã†
- endDate < startDate ã¯ 422
- key/name ã®ä¸€æ„æ€§ãŒè¡çªã—ãŸå ´åˆã¯ 409
- unknown field ã¯ 400

ãƒ¬ã‚¹ãƒãƒ³ã‚¹(201):
- Location: /v1/projects/{id}
- Body: Project

2) GET /v1/projects
ç›®çš„: ä¸€è¦§å–å¾—
ã‚¯ã‚¨ãƒª:
- q: æ–‡å­—åˆ—ã€‚name / key / ownerEmail ã«éƒ¨åˆ†ä¸€è‡´ï¼ˆå¤§æ–‡å­—å°æ–‡å­—ç„¡è¦–ï¼‰
- status: "active" | "archived"ï¼ˆdefault: activeï¼‰
- sort: "name" | "createdAt" | "updatedAt" | "budget"ï¼ˆdefault: createdAtï¼‰
- order: "asc" | "desc"ï¼ˆdefault: ascï¼‰
- limit: 1..50ï¼ˆdefault: 20ï¼‰
- offset: 0ä»¥ä¸Šã®æ•´æ•°ï¼ˆdefault: 0ï¼‰

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³:
- limit/offset/sort/order/status ãŒä¸æ­£ãªå ´åˆã¯ 422

ãƒ¬ã‚¹ãƒãƒ³ã‚¹(200):
{
  "items": Project[],
  "total": number,
  "limit": number,
  "offset": number
}

3) GET /v1/projects/:id
- å­˜åœ¨ã—ãªã„IDã¯ 404
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã« ETag ã‚’ä»˜ä¸

4) PATCH /v1/projects/:id
ç›®çš„: éƒ¨åˆ†æ›´æ–°
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ(JSON):
- ç©ºã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ 400ï¼ˆvalidation_errorï¼‰
- JSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä»¥å¤–ã¯ 400ï¼ˆvalidation_errorï¼‰
- æ›´æ–°å¯èƒ½: name, ownerEmail, budget, startDate, endDate
- id/key/status/createdAt/updatedAt/archivedAt/version ã‚’å«ã‚ãŸå ´åˆã¯ 400ï¼ˆstatusã¯archive/restore APIã§å¤‰æ›´ï¼‰
- æ­£å¸¸æ™‚ã€updatedAt ã¨ version ã‚’æ›´æ–°ã™ã‚‹

ãƒ¬ã‚¹ãƒãƒ³ã‚¹(200): Project

5) POST /v1/projects/:id/archive
ç›®çš„: ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
- status ã‚’ "archived" ã«ã—ã€archivedAt ã‚’ç¾åœ¨æ™‚åˆ»(UTC)ã§è¨­å®š
- å­˜åœ¨ã—ãªã„IDã¯ 404
- æ—¢ã« archived ã®å ´åˆã¯ 409
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ Project

6) POST /v1/projects/:id/restore
ç›®çš„: å¾©å…ƒ
- status ã‚’ "active" ã«ã—ã€archivedAt ã‚’ null ã«ã™ã‚‹
- å­˜åœ¨ã—ãªã„IDã¯ 404
- status ãŒ "active" ã®å ´åˆã¯ 409
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ Project

7) DELETE /v1/projects/:id
ç›®çš„: ç‰©ç†å‰Šé™¤
- If-Match ã¯ä¸è¦ï¼ˆTask/Label ã¨ç•°ãªã‚‹ï¼‰
- å¯¾è±¡ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ 404
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ 204ï¼ˆãƒœãƒ‡ã‚£ãªã—ï¼‰

è¿½åŠ æ©Ÿèƒ½: ã‚¿ã‚¹ã‚¯ä¾å­˜é–¢ä¿‚ï¼ˆDependenciesï¼‰
èƒŒæ™¯
è¤‡é›‘ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ã‚¿ã‚¹ã‚¯é–“ã«ã€Œã“ã‚ŒãŒçµ‚ã‚ã‚‰ãªã„ã¨å§‹ã‚ã‚‰ã‚Œãªã„ã€ã¨ã„ã†ä¾å­˜é–¢ä¿‚ãŒã‚ã‚‹ã€‚
ä¾å­˜é–¢ä¿‚ã‚’æ˜ç¤ºçš„ã«ç®¡ç†ã™ã‚‹ã“ã¨ã§ã€ä½œæ¥­é †åºã®å¯è¦–åŒ–ã¨æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿç¾ã™ã‚‹ã€‚

Taskãƒ‡ãƒ¼ã‚¿å®šç¾©ã¸ã®è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
- blockedBy: string[]ï¼ˆä¾å­˜å…ˆã‚¿ã‚¹ã‚¯IDã®é…åˆ—ã€‚ç©ºé…åˆ—å¯ï¼‰

ä¾å­˜é–¢ä¿‚ã®å…±é€šãƒ«ãƒ¼ãƒ«
1) åŸºæœ¬ãƒ«ãƒ¼ãƒ«
- blockedBy ã«ã¯ä»–ã®ã‚¿ã‚¹ã‚¯IDã‚’é…åˆ—ã§æŒ‡å®šã™ã‚‹
- è‡ªå·±å‚ç…§ï¼ˆè‡ªåˆ†è‡ªèº«ã®IDã‚’å«ã‚€ï¼‰ã¯ 422
- å­˜åœ¨ã—ãªã„ã‚¿ã‚¹ã‚¯IDã‚’æŒ‡å®šã—ãŸå ´åˆã¯ 422
- è«–ç†å‰Šé™¤ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯IDã‚’æŒ‡å®šã—ãŸå ´åˆã¯ 422
- é‡è¤‡ã™ã‚‹IDã¯è‡ªå‹•ã§é™¤å»ã—ã€æ˜‡é †ã‚½ãƒ¼ãƒˆã—ã¦ä¿å­˜

2) å¾ªç’°ä¾å­˜ã®æ¤œå‡º
- A â†’ B â†’ C â†’ A ã®ã‚ˆã†ãªå¾ªç’°ä¾å­˜ã¯ 422
- ç›´æ¥çš„ãªå¾ªç’°ã ã‘ã§ãªãã€é–“æ¥çš„ãªå¾ªç’°ã‚‚æ¤œå‡ºã™ã‚‹ã“ã¨
- ä¾‹: A.blockedBy = [B], B.blockedBy = [C], C.blockedBy = [A] ã¯å¾ªç’°
- å¾ªç’°æ¤œå‡ºã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¯ "circular_dependency" ã‚’å«ã‚ã‚‹ã“ã¨

3) çŠ¶æ…‹é·ç§»ã®åˆ¶ç´„
- ã‚¿ã‚¹ã‚¯ã‚’ "done" ã«ã™ã‚‹å ´åˆã€blockedBy ã«å«ã¾ã‚Œã‚‹å…¨ã‚¿ã‚¹ã‚¯ãŒ "done" ã§ãªã‘ã‚Œã° 422
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¯ "blocked_by_incomplete" ã‚’å«ã‚ã‚‹ã“ã¨
- ä¾å­˜å…ˆã‚¿ã‚¹ã‚¯ãŒè«–ç†å‰Šé™¤ã•ã‚ŒãŸå ´åˆã€ãã®ä¾å­˜ã¯è‡ªå‹•çš„ã«è§£é™¤ã•ã‚Œã‚‹ï¼ˆblockedByã‹ã‚‰é™¤å»ï¼‰

4) å‰Šé™¤æ™‚ã®åˆ¶ç´„
- ä»–ã®ã‚¿ã‚¹ã‚¯ã‹ã‚‰ä¾å­˜ã•ã‚Œã¦ã„ã‚‹ï¼ˆblockedBy ã«å«ã¾ã‚Œã¦ã„ã‚‹ï¼‰ã‚¿ã‚¹ã‚¯ã¯å‰Šé™¤ä¸å¯ï¼ˆ409ï¼‰
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¯ "has_dependents" ã‚’å«ã‚ã‚‹ã“ã¨

5) POST /v1/tasks ã¸ã®è¿½åŠ 
- blockedBy: ä»»æ„ã€‚æœªæŒ‡å®šæ™‚ã¯ç©ºé…åˆ—

6) PATCH /v1/tasks/:id ã¸ã®è¿½åŠ 
- blockedBy: æ›´æ–°å¯èƒ½ã€‚null ã§ç©ºé…åˆ—ã«ã‚¯ãƒªã‚¢

7) GET /v1/tasks ã¸ã®è¿½åŠ ã‚¯ã‚¨ãƒª
- hasBlockers: "true" | "false"ï¼ˆblockedByãŒç©ºã§ãªã„ã‚¿ã‚¹ã‚¯ / ç©ºã®ã‚¿ã‚¹ã‚¯ï¼‰ã€‚ä¸æ­£ãªå€¤ã¯ 422
- isBlocked: "true" | "false"ï¼ˆæœªå®Œäº†ã®ä¾å­˜å…ˆãŒã‚ã‚‹ã‚¿ã‚¹ã‚¯ / ãªã„ã‚¿ã‚¹ã‚¯ï¼‰ã€‚ä¸æ­£ãªå€¤ã¯ 422

è¿½åŠ æ©Ÿèƒ½: ã‚µãƒ–ã‚¿ã‚¹ã‚¯ï¼ˆSubtasksï¼‰
èƒŒæ™¯
å¤§ããªã‚¿ã‚¹ã‚¯ã‚’å°ã•ãªã‚µãƒ–ã‚¿ã‚¹ã‚¯ã«åˆ†å‰²ã—ã¦ç®¡ç†ã—ãŸã„ã€‚
è¦ªã‚¿ã‚¹ã‚¯ã®é€²æ—ã¯å­ã‚¿ã‚¹ã‚¯ã®å®Œäº†çŠ¶æ³ã‹ã‚‰è‡ªå‹•è¨ˆç®—ã•ã‚Œã‚‹ã€‚

Taskãƒ‡ãƒ¼ã‚¿å®šç¾©ã¸ã®è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
- parentId: string | nullï¼ˆè¦ªã‚¿ã‚¹ã‚¯ã®IDï¼‰
- progress: integerï¼ˆ0..100ã€è‡ªå‹•è¨ˆç®—ã€‚å­ã‚¿ã‚¹ã‚¯ãŒãªã„å ´åˆã¯ status ã«å¿œã˜ã¦ 0 or 100ï¼‰

ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã®å…±é€šãƒ«ãƒ¼ãƒ«
1) åŸºæœ¬ãƒ«ãƒ¼ãƒ«
- parentId ã«ã¯æ—¢å­˜ã‚¿ã‚¹ã‚¯ã®IDã‚’æŒ‡å®šã§ãã‚‹
- è‡ªå·±å‚ç…§ã¯ 422
- å­˜åœ¨ã—ãªã„ã‚¿ã‚¹ã‚¯IDã¯ 422
- è«–ç†å‰Šé™¤ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯IDã¯ 422
- ãƒã‚¹ãƒˆã¯æœ€å¤§3éšå±¤ã¾ã§ï¼ˆè¦ªâ†’å­â†’å­«ã¾ã§ï¼‰ã€‚è¶…éã¯ 422

2) é€²æ—ã®è‡ªå‹•è¨ˆç®—
- å­ã‚¿ã‚¹ã‚¯ãŒãªã„å ´åˆ: status ãŒ "open" ãªã‚‰ 0ã€"done" ãªã‚‰ 100
- å­ã‚¿ã‚¹ã‚¯ãŒã‚ã‚‹å ´åˆ: (å®Œäº†ã—ãŸå­ã‚¿ã‚¹ã‚¯æ•° / å…¨å­ã‚¿ã‚¹ã‚¯æ•°) * 100 ã®åˆ‡ã‚Šæ¨ã¦æ•´æ•°
- å­ã‚¿ã‚¹ã‚¯ã®ã‚«ã‚¦ãƒ³ãƒˆã«ã¯è«–ç†å‰Šé™¤ã•ã‚ŒãŸã‚‚ã®ã¯å«ã‚ãªã„
- é€²æ—è¨ˆç®—ã¯å†å¸°çš„ã§ã¯ãªã„ï¼ˆç›´æ¥ã®å­ã®ã¿ã‚«ã‚¦ãƒ³ãƒˆï¼‰

3) çŠ¶æ…‹é·ç§»ã®åˆ¶ç´„
- å­ã‚¿ã‚¹ã‚¯ãŒ1ã¤ã§ã‚‚ "open" ã®å ´åˆã€è¦ªã‚¿ã‚¹ã‚¯ã‚’ "done" ã«ã§ããªã„ï¼ˆ422ï¼‰
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¯ "has_incomplete_children" ã‚’å«ã‚ã‚‹ã“ã¨
- è¦ªã‚¿ã‚¹ã‚¯ãŒ "done" ã®å ´åˆã€å­ã‚¿ã‚¹ã‚¯ã‚’ "open" ã«æˆ»ã™ã“ã¨ã¯ã§ããªã„ï¼ˆ422ï¼‰
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¯ "parent_already_done" ã‚’å«ã‚ã‚‹ã“ã¨

4) å‰Šé™¤æ™‚ã®åˆ¶ç´„
- å­ã‚¿ã‚¹ã‚¯ã‚’æŒã¤ã‚¿ã‚¹ã‚¯ã¯å‰Šé™¤ä¸å¯ï¼ˆ409ï¼‰
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¯ "has_children" ã‚’å«ã‚ã‚‹ã“ã¨
- å‰Šé™¤ã—ãŸã„ã‚¿ã‚¹ã‚¯ã«å­ãŒã‚ã‚‹å ´åˆã¯ã€å…ˆã«å­ã® parentId ã‚’ null ã«æ›´æ–°ã™ã‚‹ã‹ã€å­ã‚’å‰Šé™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

5) POST /v1/tasks ã¸ã®è¿½åŠ 
- parentId: ä»»æ„ã€‚æœªæŒ‡å®šæ™‚ã¯ null

6) PATCH /v1/tasks/:id ã¸ã®è¿½åŠ 
- parentId: æ›´æ–°å¯èƒ½ã€‚null ã§è¦ªå­é–¢ä¿‚ã‚’è§£é™¤
- parentId ã‚’å¤‰æ›´ã™ã‚‹å ´åˆã€ãƒã‚¹ãƒˆåˆ¶é™ã‚’å†ãƒã‚§ãƒƒã‚¯

7) GET /v1/tasks ã¸ã®è¿½åŠ ã‚¯ã‚¨ãƒª
- parentId: æŒ‡å®šã—ãŸIDã®å­ã‚¿ã‚¹ã‚¯ã®ã¿å–å¾—ã€‚"null" ã‚’æŒ‡å®šã™ã‚‹ã¨ãƒ«ãƒ¼ãƒˆã‚¿ã‚¹ã‚¯ã®ã¿
- hasChildren: "true" | "false"ï¼ˆå­ã‚¿ã‚¹ã‚¯ã‚’æŒã¤ã‚¿ã‚¹ã‚¯ / æŒãŸãªã„ã‚¿ã‚¹ã‚¯ï¼‰ã€‚ä¸æ­£ãªå€¤ã¯ 422

8) GET /v1/tasks/:id/children
ç›®çš„: æŒ‡å®šã‚¿ã‚¹ã‚¯ã®ç›´æ¥ã®å­ã‚¿ã‚¹ã‚¯ä¸€è¦§ã‚’å–å¾—
- å­˜åœ¨ã—ãªã„ã‚¿ã‚¹ã‚¯IDã¯ 404
- è«–ç†å‰Šé™¤ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã¯ 404ï¼ˆincludeDeleted=true ã§ã‚‚å–å¾—ä¸å¯ï¼‰

ãƒ¬ã‚¹ãƒãƒ³ã‚¹(200):
{
  "items": Task[],
  "total": number
}
- è«–ç†å‰Šé™¤ã•ã‚ŒãŸå­ã‚¿ã‚¹ã‚¯ã¯å«ã‚ãªã„
- includeDeleted=true ã§è«–ç†å‰Šé™¤ã•ã‚ŒãŸå­ã‚¿ã‚¹ã‚¯ã‚‚å«ã‚ã‚‹
- æ³¨æ„: parentId ãŒ null ã«æ›´æ–°ã•ã‚ŒãŸå¾Œã«å‰Šé™¤ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã¯ã€includeDeleted=true ã§ã‚‚è¡¨ç¤ºã•ã‚Œãªã„ï¼ˆè¦ªå­é–¢ä¿‚ãŒè§£é™¤ã•ã‚Œã¦ã„ã‚‹ãŸã‚ï¼‰

è¿½åŠ æ©Ÿèƒ½: Unicodeæ­£è¦åŒ–å¼·åŒ–
èƒŒæ™¯
æ—¥æœ¬èªç’°å¢ƒã§ã¯å…¨è§’/åŠè§’ã®æ··åœ¨ãŒé »ç¹ã«ç™ºç”Ÿã™ã‚‹ã€‚
è¡¨è¨˜æºã‚Œã‚’é˜²ããŸã‚ã€ã‚ˆã‚Šå³å¯†ãªæ­£è¦åŒ–ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨ã™ã‚‹ã€‚

æ­£è¦åŒ–ãƒ«ãƒ¼ãƒ«ï¼ˆtitle, description, name ã«é©ç”¨ï¼‰
1) å…¨è§’è‹±æ•°å­— â†’ åŠè§’è‹±æ•°å­—
- "ï¼¡" â†’ "A", "ï½" â†’ "a", "ï¼" â†’ "0" ãªã©
- å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ "ã€€" â†’ åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ " "

2) å…¨è§’è¨˜å· â†’ åŠè§’è¨˜å·ï¼ˆä¸€éƒ¨ï¼‰
- "ï¼" â†’ "!", "ï¼Ÿ" â†’ "?", "ï¼ˆ" â†’ "(", "ï¼‰" â†’ ")"
- "ï¼»" â†’ "[", "ï¼½" â†’ "]", "ï½›" â†’ "{", "ï½" â†’ "}"
- "ï¼š" â†’ ":", "ï¼›" â†’ ";", "ã€" â†’ ",", "ã€‚" â†’ "."

3) ã‚¼ãƒ­å¹…æ–‡å­—ã®é™¤å»
- U+200B (Zero Width Space)
- U+200C (Zero Width Non-Joiner)
- U+200D (Zero Width Joiner)
- U+FEFF (BOM / Zero Width No-Break Space)

4) åˆ¶å¾¡æ–‡å­—ã®é™¤å»
- U+0000ã€œU+001Fï¼ˆæ”¹è¡Œ U+000Aã€ã‚¿ãƒ– U+0009 ã‚’é™¤ãï¼‰
- U+007F (DEL)

5) NFCã«ã‚ˆã‚‹Unicodeæ­£è¦åŒ–
- åˆæˆå¯èƒ½ãªæ–‡å­—ã¯åˆæˆå½¢ã«çµ±ä¸€ï¼ˆä¾‹: ãŒ â†’ ãŒï¼‰
- ã“ã‚Œã¯æœ€å¾Œã«é©ç”¨ã™ã‚‹

6) é€£ç¶šã™ã‚‹ç©ºç™½ã®æ­£è¦åŒ–ï¼ˆæ—¢å­˜ãƒ«ãƒ¼ãƒ«ï¼‰
- å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’åŠè§’ã«å¤‰æ›å¾Œã€é€£ç¶šç©ºç™½ã¯1ã¤ã®åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã«

æ³¨æ„: ã“ã®æ­£è¦åŒ–ã¯ Task.title, Task.description, Label.name, Label.description, Project.name, Comment.body ã«é©ç”¨ã™ã‚‹ã€‚
tags ã®æ­£è¦åŒ–ãƒ«ãƒ¼ãƒ«ã¯æ—¢å­˜ã®ã¾ã¾ï¼ˆå°æ–‡å­—åŒ–ã€å‰å¾Œç©ºç™½é™¤å»ã®ã¿ï¼‰ã€‚

è¿½åŠ æ©Ÿèƒ½: ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆCommentsï¼‰
èƒŒæ™¯
ã‚¿ã‚¹ã‚¯ã«å¯¾ã™ã‚‹è­°è«–ã‚„è£œè¶³æƒ…å ±ã‚’è¨˜éŒ²ã™ã‚‹ãŸã‚ã€ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ã€‚

Commentãƒ‡ãƒ¼ã‚¿å®šç¾©
- id: stringï¼ˆæ­£è¦è¡¨ç¾ ^CMT-[A-Z0-9]{8}$ï¼‰
- taskId: stringï¼ˆç´ã¥ãã‚¿ã‚¹ã‚¯IDï¼‰
- body: stringï¼ˆæœ¬æ–‡ï¼‰
- mentions: string[]ï¼ˆãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼åã®é…åˆ—ï¼‰
- reactions: { [emoji: string]: number }ï¼ˆãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®çµµæ–‡å­—ã¨ã‚«ã‚¦ãƒ³ãƒˆï¼‰
- createdAt: stringï¼ˆISO 8601, UTCï¼‰
- updatedAt: stringï¼ˆISO 8601, UTCï¼‰
- deletedAt: string | nullï¼ˆISO 8601, UTCï¼‰
- version: integerï¼ˆ1ã‹ã‚‰é–‹å§‹ã—æ›´æ–°ã”ã¨ã«+1ï¼‰

Commentã®å…±é€šãƒ«ãƒ¼ãƒ«
1) body ã®æ­£è¦åŒ–
- å‰å¾Œç©ºç™½é™¤å»
- é€£ç¶šã™ã‚‹ç©ºç™½ã¯1ã¤ã®åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã«
- Unicodeæ­£è¦åŒ–ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨
- æ­£è¦åŒ–å¾Œã®é•·ã• 1..1000
- ç©ºæ–‡å­—ã«ãªã‚‹å ´åˆã¯ 422

2) mentions ã®è‡ªå‹•æŠ½å‡º
- body å†…ã® @username ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è‡ªå‹•æŠ½å‡º
- username ã¯ ^[a-zA-Z][a-zA-Z0-9_]{2,19}$ ã«ãƒãƒƒãƒã™ã‚‹ã‚‚ã®ã®ã¿
- é‡è¤‡é™¤å»ã€æ˜‡é †ã‚½ãƒ¼ãƒˆï¼ˆå¤§æ–‡å­—å°æ–‡å­—ç„¡è¦–ï¼‰
- mentionsã¯è‡ªå‹•è¨ˆç®—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãŸã‚ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å«ã‚ã‚‹ã¨ 400 (unknown_field)

3) reactions ã®åˆæœŸå€¤
- ä½œæˆæ™‚ã¯ç©ºã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ {}

4) ETag / If-Match
- GET(å˜ä¸€), POST, PATCH, DELETE ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã« ETag ã‚’ä»˜ä¸
- PATCH/DELETE ã¯ If-Match å¿…é ˆ

1) POST /v1/tasks/:taskId/comments
ç›®çš„: ã‚³ãƒ¡ãƒ³ãƒˆä½œæˆ
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ(JSON):
{
  "id"?: string,
  "body": string
}

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³:
- taskId ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ 404
- taskId ãŒè«–ç†å‰Šé™¤ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ 404
- body: å¿…é ˆã€‚æ­£è¦åŒ–å¾Œ 1..1000
- id: ä»»æ„ã€‚æŒ‡å®šæ™‚ã¯ ^CMT-[A-Z0-9]{8}$ã€‚æ—¢å­˜IDã¨é‡è¤‡ã§ 409
- unknown field ã¯ 400

ãƒ¬ã‚¹ãƒãƒ³ã‚¹(201):
- Location: /v1/tasks/{taskId}/comments/{id}
- Body: Comment

2) GET /v1/tasks/:taskId/comments
ç›®çš„: ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§å–å¾—
- taskId ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ 404
- taskId ãŒè«–ç†å‰Šé™¤ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ 404
ã‚¯ã‚¨ãƒª:
- q: æ–‡å­—åˆ—ã€‚body ã«éƒ¨åˆ†ä¸€è‡´ï¼ˆå¤§æ–‡å­—å°æ–‡å­—ç„¡è¦–ï¼‰
- mention: ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€‚æŒ‡å®šã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã•ã‚Œã¦ã„ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆ
- includeDeleted: "true" | "false" | "only"ï¼ˆdefault: falseï¼‰
- sort: "createdAt" | "updatedAt"ï¼ˆdefault: createdAtï¼‰
- order: "asc" | "desc"ï¼ˆdefault: ascï¼‰
- limit: 1..100ï¼ˆdefault: 50ï¼‰
- offset: 0ä»¥ä¸Šã®æ•´æ•°ï¼ˆdefault: 0ï¼‰

ãƒ¬ã‚¹ãƒãƒ³ã‚¹(200):
{
  "items": Comment[],
  "total": number,
  "limit": number,
  "offset": number
}

3) GET /v1/tasks/:taskId/comments/:commentId
- å­˜åœ¨ã—ãªã„commentIdã¯ 404
- taskIdã¨ç´ã¥ã‹ãªã„commentIdã¯ 404
- deletedAt ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€includeDeleted=true ã®æ™‚ã®ã¿è¿”ã™

4) PATCH /v1/tasks/:taskId/comments/:commentId
ç›®çš„: ã‚³ãƒ¡ãƒ³ãƒˆæ›´æ–°
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ(JSON):
- ç©ºã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ 400ï¼ˆvalidation_errorï¼‰
- æ›´æ–°å¯èƒ½: body
- id/taskId/mentions/reactions/createdAt/updatedAt/deletedAt/version ã‚’å«ã‚ãŸå ´åˆã¯ 400
- æ­£å¸¸æ™‚ã€updatedAt ã¨ version ã‚’æ›´æ–°

ãƒ¬ã‚¹ãƒãƒ³ã‚¹(200): Comment

5) DELETE /v1/tasks/:taskId/comments/:commentId
ç›®çš„: è«–ç†å‰Šé™¤
- deletedAt ã‚’ç¾åœ¨æ™‚åˆ»ã«è¨­å®šã—ã€version+1
- æ—¢ã«å‰Šé™¤æ¸ˆã¿ã¯ 404

6) POST /v1/tasks/:taskId/comments/:commentId/reactions
ç›®çš„: ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ 
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ(JSON):
{
  "emoji": string
}

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³:
- emoji: å¿…é ˆã€‚Unicodeçµµæ–‡å­—1æ–‡å­—ã®ã¿ï¼ˆæ­£è¦è¡¨ç¾: ^\p{Emoji}$ã€ãŸã ã—ASCIIæ–‡å­—ã‚’é™¤ãï¼‰
- è¨±å¯ã™ã‚‹çµµæ–‡å­—: ğŸ‘ğŸ‘ğŸ˜€ğŸ˜¢ğŸ˜®ğŸ‰ğŸ’¯ğŸ”¥â¤ï¸âœ…
- ä¸Šè¨˜ä»¥å¤–ã®çµµæ–‡å­—ã¯ 422

å‡¦ç†:
- å¯¾è±¡ã®çµµæ–‡å­—ã®ã‚«ã‚¦ãƒ³ãƒˆã‚’+1
- åŒä¸€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰ã®é‡è¤‡è¿½åŠ ã¯è€ƒæ…®ã—ãªã„ï¼ˆå˜ç´”ã«ã‚«ã‚¦ãƒ³ãƒˆå¢—åŠ ï¼‰

ãƒ¬ã‚¹ãƒãƒ³ã‚¹(200): Commentï¼ˆreactionsæ›´æ–°å¾Œï¼‰
- version ã¯æ›´æ–°ã—ãªã„ï¼ˆãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ãƒã‚¤ãƒŠãƒ¼å¤‰æ›´æ‰±ã„ï¼‰

7) DELETE /v1/tasks/:taskId/comments/:commentId/reactions/:emoji
ç›®çš„: ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³å‰Šé™¤
- emoji ã¯URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸçµµæ–‡å­—
- å¯¾è±¡ã®ã‚«ã‚¦ãƒ³ãƒˆã‚’-1ï¼ˆ0ã«ãªã£ãŸã‚‰ã‚­ãƒ¼ã‚’å‰Šé™¤ï¼‰
- ã‚«ã‚¦ãƒ³ãƒˆãŒ0ã¾ãŸã¯å­˜åœ¨ã—ãªã„å ´åˆã¯ 404

ãƒ¬ã‚¹ãƒãƒ³ã‚¹(200): Comment

è¿½åŠ æ©Ÿèƒ½: ãƒãƒƒãƒæ“ä½œï¼ˆBatch Operationsï¼‰
èƒŒæ™¯
è¤‡æ•°ã‚¿ã‚¹ã‚¯ã®ä¸€æ‹¬æ“ä½œã‚’åŠ¹ç‡çš„ã«è¡Œã„ãŸã„ã€‚
å€‹åˆ¥APIã‚’ä½•åº¦ã‚‚å‘¼ã¶ã®ã¯éåŠ¹ç‡ãªãŸã‚ã€ãƒãƒƒãƒAPIã‚’æä¾›ã™ã‚‹ã€‚

1) POST /v1/tasks/batch
ç›®çš„: ã‚¿ã‚¹ã‚¯ã®ä¸€æ‹¬ä½œæˆ/æ›´æ–°/å‰Šé™¤
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ(JSON):
{
  "operations": [
    { "method": "create", "body": { ... } },
    { "method": "update", "id": "TASKID01", "body": { ... }, "version": 1 },
    { "method": "delete", "id": "TASKID02", "version": 2 }
  ]
}

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³:
- operations: å¿…é ˆã€‚æ¬ è½ã¾ãŸã¯é…åˆ—ã§ãªã„å ´åˆã¯ 400
- operations: 1..20ä»¶ã®é…åˆ—ã€‚ç¯„å›²å¤–ã¯ 422
- å„æ“ä½œã® method: "create" | "update" | "delete"ã€‚ä¸æ­£ãªå€¤ã¯ 422
- update/delete ã«ã¯ id ã¨ version ãŒå¿…é ˆã€‚æ¬ è½ã¯ 422
- version ã¯å¯¾è±¡ã‚¿ã‚¹ã‚¯ã®ç¾åœ¨ã®versionã¨ä¸€è‡´ã™ã‚‹ã“ã¨ï¼ˆETagã®ä»£ã‚ã‚Šï¼‰

å‡¦ç†ãƒ«ãƒ¼ãƒ«:
- æ“ä½œã¯é…åˆ—ã®é †åºã§å®Ÿè¡Œã•ã‚Œã‚‹
- ã„ãšã‚Œã‹ã®æ“ä½œãŒå¤±æ•—ã—ãŸå ´åˆã€ãã‚Œä»¥é™ã®æ“ä½œã¯å®Ÿè¡Œã—ãªã„ï¼ˆãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ã—ãªã„ï¼‰
- ä¾å­˜é–¢ä¿‚ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãƒãƒƒãƒå†…ã®æ“ä½œã‚’ã™ã¹ã¦è€ƒæ…®ã™ã‚‹
  ï¼ˆä¾‹: æ“ä½œ1ã§ã‚¿ã‚¹ã‚¯Aã‚’ä½œæˆã€æ“ä½œ2ã§ã‚¿ã‚¹ã‚¯Bã®blockedByã«Aã‚’æŒ‡å®š â†’ æœ‰åŠ¹ï¼‰

ãƒ¬ã‚¹ãƒãƒ³ã‚¹(200):
{
  "results": [
    { "index": 0, "success": true, "task": Task },
    { "index": 1, "success": true, "task": Task },
    { "index": 2, "success": false, "error": { "code": "...", "message": "..." } }
  ],
  "successCount": number,
  "failureCount": number
}

ãƒ¬ã‚¹ãƒãƒ³ã‚¹(400): operations ãŒä¸æ­£ãªå ´åˆ
ãƒ¬ã‚¹ãƒãƒ³ã‚¹(422): ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ï¼ˆé…åˆ—å½¢å¼ãƒã‚§ãƒƒã‚¯ãªã©ï¼‰

2) POST /v1/tasks/batch/status
ç›®çš„: è¤‡æ•°ã‚¿ã‚¹ã‚¯ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ä¸€æ‹¬å¤‰æ›´
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ(JSON):
{
  "ids": ["TASKID01", "TASKID02", ...],
  "status": "open" | "done"
}

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³:
- ids: å¿…é ˆã€‚æ¬ è½ã¯ 400ã€‚1..50ä»¶ã®é…åˆ—ã€‚ç¯„å›²å¤–ã¯ 422
- status: å¿…é ˆã€‚æ¬ è½ã¯ 400ã€‚ä¸æ­£ãªå€¤ã¯ 422
- å­˜åœ¨ã—ãªã„IDã€è«–ç†å‰Šé™¤ã•ã‚ŒãŸIDã¯ç„¡è¦–ï¼ˆã‚¨ãƒ©ãƒ¼ã«ã—ãªã„ï¼‰

å‡¦ç†ãƒ«ãƒ¼ãƒ«:
- ä¾å­˜é–¢ä¿‚ã®åˆ¶ç´„ï¼ˆblockedByã€å­ã‚¿ã‚¹ã‚¯ï¼‰ã«ã‚ˆã‚Šå¤‰æ›´ã§ããªã„ã‚¿ã‚¹ã‚¯ã¯ã‚¹ã‚­ãƒƒãƒ—
- å¤‰æ›´ã§ããŸã‚¿ã‚¹ã‚¯ã®ã¿ version ã‚’æ›´æ–°

ãƒ¬ã‚¹ãƒãƒ³ã‚¹(200):
{
  "updated": string[],  // æ›´æ–°ã§ããŸã‚¿ã‚¹ã‚¯ID
  "skipped": [          // ã‚¹ã‚­ãƒƒãƒ—ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯
    { "id": string, "reason": string }
  ]
}
